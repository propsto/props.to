// Define the data source
datasource db {
  provider = "postgresql"
}

// Define the generator
generator client {
  provider   = "prisma-client-js"
  engineType = "client"
}

// Enum for Role (User, Platform Admin)
enum Role {
  USER
  PROPSTO_ADMIN
}

// Enum for organization-specific roles
enum OrganizationRole {
  OWNER // Created the org, full control
  ADMIN // Can manage org settings
  MEMBER // Regular member
}

// Enum for resources that can be paid for
enum PayableResource {
  PREMIUM_USERNAME
  ADDITIONAL_INTEGRATION
  FEEDBACK_TEMPLATE
}

// Enum for profile visibility
enum ProfileVisibility {
  PUBLIC
  PRIVATE
  ORGANIZATION
}

// Enum for account type
enum AccountType {
  INDIVIDUAL
  ORGANIZATION
}

// Enum for slug scope (determines namespace for uniqueness)
enum SlugScope {
  GLOBAL // Top-level namespace: personal users, organizations
  ORGANIZATION // Scoped within an organization: org members, groups
}

// Enum for feedback visibility
enum FeedbackVisibility {
  PUBLIC // Visible to everyone
  PRIVATE // Visible only to recipient
  ORGANIZATION // Visible to org members
  ANONYMOUS // Anonymous feedback (no sender info shown)
}

// Enum for feedback type
enum FeedbackType {
  RECOGNITION // Props/recognition for good work
  THREE_SIXTY // 360 degree feedback
  PEER_REVIEW // Peer review
  MANAGER_FEEDBACK // Feedback from manager
  REPORT_FEEDBACK // Feedback from direct reports
  SELF_ASSESSMENT // Self review
  ANONYMOUS // Anonymous feedback
}

// Enum for feedback status
enum FeedbackStatus {
  DRAFT // Not yet submitted
  PENDING_MODERATION // Awaiting approval
  APPROVED // Approved and visible
  REJECTED // Rejected by moderator
  ARCHIVED // Archived/hidden
}

// Enum for feedback request status
enum FeedbackRequestStatus {
  PENDING
  COMPLETED
  EXPIRED
  CANCELLED
}

// Enum for goal status
enum GoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Enum for template field types
enum FieldType {
  TEXT
  TEXTAREA
  NUMBER
  RATING // 1-5 stars
  SCALE // 1-10 scale
  SELECT
  RADIO
  CHECKBOX
  DATE
}

// Enum for audit log actions
enum AuditAction {
  // Member actions
  MEMBER_INVITED
  MEMBER_REMOVED
  MEMBER_ROLE_CHANGED

  // Settings actions
  SETTINGS_UPDATED
  ORG_URL_CHANGED

  // Category actions
  CATEGORY_CREATED
  CATEGORY_UPDATED
  CATEGORY_DELETED

  // Template actions
  TEMPLATE_CREATED
  TEMPLATE_UPDATED
  TEMPLATE_DELETED

  // General
  OTHER
}

// Organization model (represents an organization, e.g., Acme Corp)
model Organization {
  id           String               @id @default(cuid())
  name         String               @unique // Organization name
  hostedDomain String?              @unique // Google Workspace domain (e.g., "acme.com")
  members      OrganizationMember[] // Users associated with the organization via junction table
  slug         Slug                 @relation("OrganizationSlug", fields: [slugId], references: [id], onDelete: Cascade)
  slugId       String               @unique
  scopedSlugs  Slug[]               @relation("ScopedSlugs") // Slugs scoped to this organization (members, groups)
  groups       Group[] // Groups within the organization (e.g., marketing team, HR)
  feedbacks    Feedback[] // Feedback related to the organization
  templates    FeedbackTemplate[]   @relation(name: "OrganizationTemplates") // Templates associated with this organization
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  uris         Uri[] // URIs associated with the user for feedback

  // Feedback links and requests
  feedbackLinks    FeedbackLink[] // Links created for this organization
  feedbackRequests FeedbackRequest[] // Requests within this organization
  goals            Goal[] // Organization-related goals

  // Organization settings relations
  defaultUserSettings  OrganizationDefaultUserSettings?
  organizationSettings OrganizationSettings?
  feedbackSettings     OrganizationFeedbackSettings?

  // Audit logging
  auditLogs AuditLog[]

  // Custom feedback categories
  categories TemplateCategory[]

  @@unique([id, slugId])
}

// OrganizationMember model (junction table for multi-org user membership)
model OrganizationMember {
  id                      String                        @id @default(cuid())
  user                    User                          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                  String
  organization            Organization                  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId          String
  role                    OrganizationRole              @default(MEMBER)
  joinedAt                DateTime                      @default(now())
  notificationPreferences OrgMemberNotificationPrefs?

  @@unique([userId, organizationId])
}

// Per-organization notification preferences (overrides user defaults when in org context)
model OrgMemberNotificationPrefs {
  id                   String             @id @default(cuid())
  member               OrganizationMember @relation(fields: [memberId], references: [id], onDelete: Cascade)
  memberId             String             @unique
  emailNotifications   Boolean            @default(true)
  feedbackAlerts       Boolean            @default(true)
  weeklyDigest         Boolean            @default(false)
  mentionNotifications Boolean            @default(true)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime            @updatedAt
}

// Group model (represents a group within an organization, e.g., marketing team)
model Group {
  id             String             @id @default(cuid())
  slug           Slug               @relation(fields: [slugId], references: [id], onDelete: Cascade)
  slugId         String
  name           String // Name of the group (e.g., marketing team)
  organization   Organization       @relation(fields: [organizationId], references: [id])
  organizationId String // Link to the organization this group belongs to
  users          User[] // Users associated with the group
  feedbacks      Feedback[] // Feedback related to the group
  templates      FeedbackTemplate[] @relation(name: "GroupTemplates") // Templates associated with this group
  feedbackLinks  FeedbackLink[] // Feedback links for this group
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Relation to GroupAdmins (to identify admins of this group)
  admins GroupAdmin[] // Relation to identify admins of this group

  @@unique([slugId, organizationId])
}

// User model (user with personal account, can belong to multiple organizations)
model User {
  id                     String               @id @default(cuid())
  email                  String               @unique
  // Personal slug (GLOBAL scope) - the user's permanent personal identity
  slug                   Slug                 @relation("PersonalSlug", fields: [slugId], references: [id], onDelete: Cascade)
  slugId                 String               @unique
  // Organization-scoped slugs (one per org membership)
  organizationSlugs      Slug[]               @relation("UserOrgSlugs")
  password               String?
  firstName              String?
  lastName               String?
  role                   Role                 @default(USER)
  hostedDomain           String? // Google Workspace domain from OAuth (e.g., "acme.com")
  isGoogleWorkspaceAdmin Boolean              @default(false) // Whether user is a Google Workspace admin (checked on OAuth login)
  personalEmail          String?              @unique // Fallback personal email for Google Workspace users
  personalEmailVerified  DateTime? // When the personal email was verified
  dateOfBirth            DateTime?
  feedbacksReceived      Feedback[]           @relation("ReceivedFeedback") // Feedback received by the user
  feedbacksSent          Feedback[]           @relation("SentFeedback") // Feedback sent by the user
  moderatedFeedback      Feedback[]           @relation("ModeratedFeedback") // Feedback moderated by the user
  groups                 Group[] // Groups the user belongs to
  organizations          OrganizationMember[] // Organizations the user belongs to (multi-org support)
  templates              FeedbackTemplate[]   @relation(name: "UserTemplates") // Templates associated with this user
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  image                  String?
  emailVerified          DateTime?
  onboardingCompletedAt  DateTime? // Timestamp when user completed the onboarding flow
  payments               Payment[]
  uris                   Uri[] // URIs associated with the user for feedback
  UriClaim               UriClaim?
  Account                Account[]
  Session                Session[]
  Authenticator          Authenticator[]

  // Feedback links and requests
  feedbackLinks            FeedbackLink[] // Links created by this user
  feedbackRequestsSent     FeedbackRequest[] @relation("FeedbackRequestsSent") // Requests sent by this user
  feedbackRequestsReceived FeedbackRequest[] @relation("FeedbackRequestsReceived") // Requests received by this user
  goals                    Goal[] // User's goals

  // User preferences and settings relations
  notificationPreferences UserNotificationPreferences?
  privacySettings         UserPrivacySettings?
  accountSettings         UserAccountSettings?

  // Relation to GroupAdmins (to check if user is an admin of any group)
  groupAdmins GroupAdmin[] // Relation to track group admin roles

  // Audit logs where this user was the actor
  auditLogs AuditLog[] @relation("AuditLogActor")

  @@unique([id, slugId])
}

// Slug model (to store unique slugs for both users and organizations)
model Slug {
  id            String        @id @default(cuid())
  slug          String // Slug for user or organization
  scope         SlugScope     @default(GLOBAL) // Determines namespace for uniqueness
  scopedToOrg   Organization? @relation("ScopedSlugs", fields: [scopedToOrgId], references: [id], onDelete: Cascade)
  scopedToOrgId String? // The organization this slug is scoped to (null for GLOBAL)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Personal slug relation (1:1 with User - their permanent personal identity)
  personalSlugOwner User? @relation("PersonalSlug")

  // Organization slug relation (many:1 with User - their org-scoped usernames)
  orgSlugOwner   User?   @relation("UserOrgSlugs", fields: [orgSlugOwnerId], references: [id], onDelete: Cascade)
  orgSlugOwnerId String? // The user who owns this org-scoped slug

  organization Organization? @relation("OrganizationSlug")
  group        Group[]
  integration  Integration[]

  // Slug uniqueness is scoped: GLOBAL slugs are globally unique,
  // ORGANIZATION slugs are unique within their organization
  @@unique([slug, scope, scopedToOrgId])
}

// GroupAdmin model (tracks which users are admins for which groups)
model GroupAdmin {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  group     Group    @relation(fields: [groupId], references: [id])
  groupId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// TemplateCategory model (for organizing templates by skill/topic)
// Categories can be global (organizationId = null) or organization-specific
model TemplateCategory {
  id             String             @id @default(cuid())
  name           String // e.g., "Soft Skills", "Leadership", "Technical"
  description    String?
  icon           String? // Icon name for UI display
  color          String? // Color for UI display (hex code)
  organization   Organization?      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String? // null = global/system category, non-null = org-specific
  templates      FeedbackTemplate[]
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Name must be unique within scope (global or per-org)
  @@unique([organizationId, name])
}

// FeedbackTemplate model (stores templates for feedback forms)
model FeedbackTemplate {
  id            String            @id @default(cuid())
  name          String // Name of the template, e.g., "Leadership Feedback"
  description   String? // Optional description for the template
  price         Float? // Price for premium templates (nullable for free templates)
  deletedAt     DateTime? // Soft delete: Date when template was deleted (nullable)
  filePath      String? // Optional file path (for legacy or custom components)
  feedbackType  FeedbackType      @default(RECOGNITION) // Type of feedback this template is for
  isPublic      Boolean           @default(false) // Whether template is publicly available
  isDefault     Boolean           @default(false) // Whether this is a system default template
  category      TemplateCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  categoryId    String?
  organizations Organization[]    @relation("OrganizationTemplates") // Templates associated with organizations
  groups        Group[]           @relation("GroupTemplates") // Templates associated with groups
  users         User[]            @relation("UserTemplates") // Templates associated with users
  fields        TemplateField[] // Dynamic fields for this template
  feedbacks     Feedback[]
  links         FeedbackLink[] // Feedback links using this template
  requests      FeedbackRequest[] // Feedback requests using this template
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  // Organizations that have this template as their default
  defaultForOrgs OrganizationFeedbackSettings[] @relation("OrgDefaultTemplate")
}

// TemplateField model (dynamic fields for feedback templates)
model TemplateField {
  id          String           @id @default(cuid())
  template    FeedbackTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  templateId  String
  label       String // Display label for the field
  type        FieldType // Type of field input
  required    Boolean          @default(false)
  options     Json? // Options for select/radio fields (array of strings)
  placeholder String?
  helpText    String? // Help text shown below the field
  order       Int              @default(0) // Order in which fields appear
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

// Feedback model (feedback related to a user, group, or organization)
// Feedback is ALWAYS tied to a user's personal account for permanent traceability
model Feedback {
  id             BigInt           @id @default(autoincrement())
  // User is REQUIRED - feedback always belongs to a personal account (the recipient)
  user           User             @relation("ReceivedFeedback", fields: [userId], references: [id])
  userId         String
  group          Group?           @relation(fields: [groupId], references: [id], onDelete: SetNull)
  groupId        String?
  organization   Organization?    @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  organizationId String?
  template       FeedbackTemplate @relation(fields: [templateId], references: [id]) // Link to the template
  templateId     String // Link to the feedback template used for this feedback

  // Link that was used to submit this feedback (optional)
  link   FeedbackLink? @relation("LinkFeedbacks", fields: [linkId], references: [id], onDelete: SetNull)
  linkId String?

  // Feedback metadata
  visibility   FeedbackVisibility @default(PRIVATE)
  feedbackType FeedbackType       @default(RECOGNITION)
  status       FeedbackStatus     @default(APPROVED)

  // Submitter info (the person giving feedback)
  submitter      User?   @relation("SentFeedback", fields: [submitterId], references: [id], onDelete: SetNull)
  submitterId    String? // Null if anonymous or external
  submitterEmail String? // For external/anonymous feedback
  submitterName  String? // Optional name for external feedback

  // Moderation
  moderatedBy   User?     @relation("ModeratedFeedback", fields: [moderatedById], references: [id], onDelete: SetNull)
  moderatedById String?
  moderatedAt   DateTime?
  rejectReason  String? // Reason for rejection if rejected

  // Snapshot fields for traceability (preserved even if org/group is deleted)
  organizationNameSnapshot String? // Organization name at time of feedback
  groupNameSnapshot        String? // Group name at time of feedback
  userOrgRoleSnapshot      String? // User's role in org at time of feedback (OWNER/ADMIN/MEMBER)

  // Goals linked to this feedback
  goals Goal[] @relation("GoalFeedback")

  // Request that this feedback fulfills (if any)
  request FeedbackRequest? @relation("RequestFeedback")

  fieldsData Json? // Store the actual responses as JSON (e.g., answers to the feedback fields)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// FeedbackLink model (shareable links for receiving feedback)
model FeedbackLink {
  id             String             @id @default(cuid())
  slug           String // Short URL slug (e.g., "leadership-2024")
  name           String // User-friendly name for the link
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  organization   Organization?      @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  organizationId String?
  group          Group?             @relation(fields: [groupId], references: [id], onDelete: SetNull)
  groupId        String?
  template       FeedbackTemplate   @relation(fields: [templateId], references: [id])
  templateId     String
  isActive       Boolean            @default(true)
  isHidden       Boolean            @default(false) // Hidden links are not listed on public profiles
  expiresAt      DateTime? // Optional expiration date
  maxResponses   Int? // Optional max number of responses
  responseCount  Int                @default(0)
  visibility     FeedbackVisibility @default(PRIVATE)
  feedbackType   FeedbackType       @default(RECOGNITION)
  feedbacks      Feedback[]         @relation("LinkFeedbacks")
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  // Slug is unique per user+org context (same slug can be used by different users)
  @@unique([userId, organizationId, slug])
}

// FeedbackRequest model (request feedback from specific people)
model FeedbackRequest {
  id              String                @id @default(cuid())
  requester       User                  @relation("FeedbackRequestsSent", fields: [requesterId], references: [id], onDelete: Cascade)
  requesterId     String
  recipientEmail  String // Email of person to request feedback from
  recipientUser   User?                 @relation("FeedbackRequestsReceived", fields: [recipientUserId], references: [id], onDelete: SetNull)
  recipientUserId String?
  template        FeedbackTemplate      @relation(fields: [templateId], references: [id])
  templateId      String
  organization    Organization?         @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  organizationId  String?
  feedbackType    FeedbackType          @default(THREE_SIXTY)
  message         String? // Personal message to recipient
  status          FeedbackRequestStatus @default(PENDING)
  expiresAt       DateTime
  completedAt     DateTime?
  feedback        Feedback?             @relation("RequestFeedback", fields: [feedbackId], references: [id], onDelete: SetNull)
  feedbackId      BigInt?               @unique
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
}

// Goal model (for goals integration - linking feedback to personal/org goals)
model Goal {
  id             String        @id @default(cuid())
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  organizationId String?
  title          String
  description    String?
  targetDate     DateTime?
  status         GoalStatus    @default(NOT_STARTED)
  progress       Int           @default(0) // 0-100 percentage
  linkedFeedback Feedback[]    @relation("GoalFeedback")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

// Uri model (for integrating external URIs, like Instagram, email, etc.)
model Uri {
  id             BigInt        @id @default(autoincrement())
  uri            String        @unique
  integrationId  BigInt?
  integration    Integration?  @relation(fields: [integrationId], references: [id])
  uriClaims      UriClaim[] // Claims associated with this URI (e.g., feedback provided via this URI)
  organization   Organization? @relation(fields: [organizationId], references: [id]) // Reference to the organization (optional)
  organizationId String? // Reference to the organization (optional)
  user           User?         @relation(fields: [userId], references: [id]) // Reference to the user (optional)
  userId         String? // Reference to the user (optional)

  @@unique([uri, organizationId])
  @@unique([uri, userId])
  @@unique([uri, integrationId])
}

// UriClaim model (for claiming feedback from external sources)
model UriClaim {
  id        BigInt   @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @unique
  uri       Uri      @relation(fields: [uriId], references: [id])
  uriId     BigInt
  claimedAt DateTime @default(now())
}

// Integration model (defining external integrations like Instagram, email, etc.)
model Integration {
  id       BigInt  @id @default(autoincrement())
  hostname String
  subpath  String?
  uris     Uri[]
  slug     Slug?   @relation(fields: [slugId], references: [id], onDelete: Cascade)
  slugId   String
}

// Payment model (tracking payments related to subscriptions)
model Payment {
  id           BigInt          @id @default(autoincrement())
  user         User            @relation(fields: [userId], references: [id])
  userId       String
  resourceType PayableResource
  resourceId   BigInt?
  amount       Float
  paymentDate  DateTime        @default(now())
}

// Account model (linked to external integrations like social media or email accounts)
model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

// Session model (for managing user login sessions)
model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// VerificationToken model (used for verifying email or login)
model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

// Authenticator model (optional for WebAuthn support)
model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
}

// Manage password reset tokens to allow users to access that functionality
model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

// User notification preferences
model UserNotificationPreferences {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId             String   @unique
  emailNotifications Boolean  @default(true)
  feedbackAlerts     Boolean  @default(true)
  weeklyDigest       Boolean  @default(false)
  marketingEmails    Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

// User privacy settings
model UserPrivacySettings {
  id                      String            @id @default(cuid())
  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                  String            @unique
  profileVisibility       ProfileVisibility @default(PUBLIC)
  allowFeedbackFromAnyone Boolean           @default(true)
  showEmailInProfile      Boolean           @default(false)
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
}

// User account settings
model UserAccountSettings {
  id               String      @id @default(cuid())
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId           String      @unique
  accountType      AccountType @default(INDIVIDUAL)
  organizationName String?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

// Organization default user settings
model OrganizationDefaultUserSettings {
  id                               String            @id @default(cuid())
  organization                     Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId                   String            @unique
  defaultProfileVisibility         ProfileVisibility @default(ORGANIZATION)
  allowExternalFeedback            Boolean           @default(false)
  requireApprovalForPublicProfiles Boolean           @default(true)
  createdAt                        DateTime          @default(now())
  updatedAt                        DateTime          @updatedAt
}

// Organization general settings
model OrganizationSettings {
  id                       String       @id @default(cuid())
  organization             Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId           String       @unique
  allowUserInvites         Boolean      @default(true)
  enableGroupManagement    Boolean      @default(true)
  requireEmailVerification Boolean      @default(true)
  enableSSOIntegration     Boolean      @default(false)
  createdAt                DateTime     @default(now())
  updatedAt                DateTime     @updatedAt
}

// Organization feedback settings
model OrganizationFeedbackSettings {
  id                          String            @id @default(cuid())
  organization                Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId              String            @unique
  enableOrganizationFeedback  Boolean           @default(true)
  allowAnonymousFeedback      Boolean           @default(false)
  enableFeedbackModeration    Boolean           @default(true)
  autoApproveInternalFeedback Boolean           @default(true)
  allowMemberFormCreation     Boolean           @default(true) // When false, members can only use org-assigned templates
  defaultTemplate             FeedbackTemplate? @relation("OrgDefaultTemplate", fields: [defaultTemplateId], references: [id], onDelete: SetNull)
  defaultTemplateId           String? // The default template for this organization
  createdAt                   DateTime          @default(now())
  updatedAt                   DateTime          @updatedAt
}

// Audit log for tracking admin actions within an organization
model AuditLog {
  id             String       @id @default(cuid())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String
  actor          User         @relation("AuditLogActor", fields: [actorId], references: [id], onDelete: Cascade)
  actorId        String
  action         AuditAction
  resourceType   String // e.g., "member", "settings", "category", "template"
  resourceId     String? // ID of the affected resource (if applicable)
  details        Json? // Additional context (old/new values, etc.)
  ipAddress      String? // IP address of the actor
  userAgent      String? // Browser/client info
  createdAt      DateTime     @default(now())

  @@index([organizationId, createdAt])
  @@index([actorId])
}
